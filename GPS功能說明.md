# GPS定位系統功能說明

## 🎯 功能概述

員工管理系統已整合GPS定位功能，員工打卡時會自動記錄位置資訊，包括：
- GPS座標（緯度、經度）
- 中文地址（如：桃園市中壢區龍川五街15號7樓）

## 📱 使用方法

### 員工打卡
1. **開啟GPS權限**：首次使用時，瀏覽器會請求GPS權限，請點擊「允許」
2. **選擇打卡類型**：
   - 上班打卡：點擊「上班打卡」按鈕
   - 下班打卡：點擊「下班打卡」按鈕
3. **等待定位**：系統會自動獲取GPS位置並轉換為中文地址
4. **打卡完成**：顯示打卡成功訊息和位置資訊

### 管理員查看
1. 進入「出勤記錄」頁面
2. 查看員工打卡記錄，包含：
   - 上班位置
   - 下班位置
   - GPS座標（滑鼠懸停顯示）
3. 匯出Excel報表，包含完整的位置資訊

## 🔧 技術特點

### GPS定位
- 使用瀏覽器Geolocation API
- 高精度定位（GPS + 網路定位）
- 超時保護（10秒）
- 位置快取（60秒）

### 地址轉換
- 使用OpenStreetMap Nominatim服務
- 免費、無需API金鑰
- 支援中文地址顯示
- 自動簡化地址格式

### 備用方案
- GPS失敗時仍可打卡
- 座標轉地址失敗時顯示座標
- 多重錯誤處理機制

## 📍 位置資訊顯示

### 網頁顯示
- 位置圖示：📍
- 地址截斷：超過30字元自動截斷
- 座標提示：滑鼠懸停顯示精確座標

### Excel匯出
- 上班位置：完整地址
- 下班位置：完整地址
- 格式：標準Excel格式，支援搜尋

## 🚨 注意事項

### 瀏覽器要求
- 支援HTTPS（生產環境）
- 支援Geolocation API
- 建議使用Chrome、Firefox、Safari

### 權限設定
- 首次使用需授權GPS權限
- 權限被拒絕時會顯示警告
- 可在瀏覽器設定中手動啟用

### 網路要求
- 需要網路連線進行地址轉換
- 網路中斷時會顯示座標
- 建議在WiFi環境下使用

## 🔍 故障排除

### GPS無法定位
1. 檢查瀏覽器GPS權限
2. 確認設備GPS已開啟
3. 嘗試在戶外或窗邊使用
4. 檢查網路連線狀態

### 地址顯示異常
1. 檢查網路連線
2. 重新整理頁面
3. 清除瀏覽器快取
4. 檢查防火牆設定

### 打卡失敗
1. 檢查登入狀態
2. 確認打卡時間
3. 查看錯誤訊息
4. 聯繫系統管理員

## 📊 資料結構

### 資料庫欄位
```sql
-- 上班位置
clock_in_latitude    -- 上班緯度
clock_in_longitude   -- 上班經度
clock_in_address     -- 上班地址

-- 下班位置
clock_out_latitude   -- 下班緯度
clock_out_longitude  -- 下班經度
clock_out_address    -- 下班地址
```

### 資料格式
- 緯度：浮點數（如：24.9538）
- 經度：浮點數（如：121.2257）
- 地址：字串（如：桃園市中壢區龍川五街15號7樓）

## 🚀 未來擴展

### 計劃功能
- 地圖視覺化顯示
- 打卡範圍限制
- 異常位置警告
- 位置歷史軌跡
- 離線地址快取

### 技術優化
- 位置精度提升
- 地址轉換速度優化
- 多語言地址支援
- 自定義地址格式
